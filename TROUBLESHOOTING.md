# üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º AutoPoster

## üö® –ß–∞—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∞—é—â–∏–µ—Å—è –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –∏ —á–∞—Å—Ç—ã–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏

**–ü—Ä–∏–∑–Ω–∞–∫–∏:**
- –°–∏—Å—Ç–µ–º–∞ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- –í –ª–æ–≥–∞—Ö –ø–æ—è–≤–ª—è—é—Ç—Å—è —Å–∏–≥–Ω–∞–ª—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (SIGTERM, SIGINT)
- Keepalive —á–∞—Å—Ç–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ—Å–ª–µ–¥–Ω–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
cat last_shutdown.info

# –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º health check
./monitor_autoposter.sh health

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
./monitor_autoposter.sh system
```

**–†–µ—à–µ–Ω–∏—è:**
1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ—Å—É—Ä—Å—ã —Å–∏—Å—Ç–µ–º—ã:**
   ```bash
   df -h  # –ú–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
   free -h  # –ü–∞–º—è—Ç—å
   ps aux | grep python  # –ü—Ä–æ—Ü–µ—Å—Å—ã Python
   ```

2. **–£–≤–µ–ª–∏—á—å—Ç–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
   ```json
   {
     "system": {
       "check_interval": 120,
       "health_check_interval": 600
     }
   }
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Ö–æ—Å—Ç–∏–Ω–≥–∞:**
   ```bash
   tail -f /var/log/messages
   dmesg | tail
   ```

### 2. –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø—É–±–ª–∏–∫–∞—Ü–∏–π

**–ü—Ä–∏–∑–Ω–∞–∫–∏:**
- "–î–æ–≥–æ–Ω—è—é—â–∏–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏" –≤ –ª–æ–≥–∞—Ö
- –°–æ–æ–±—â–µ–Ω–∏—è "–≤—ã—Ö–æ–¥ –∑–∞ –æ–∫–Ω–æ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏" –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤
- –ù–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º health check –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤
./monitor_autoposter.sh health

# –ü—Ä–æ–≤–µ—Ä—è–µ–º debug –ª–æ–≥–∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
grep "üîç" logs/autoposter.log | tail -20
```

**–†–µ—à–µ–Ω–∏—è:**
1. **–í–∫–ª—é—á–∏—Ç–µ debug –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   ```python
   # –í autoposter.py –∏–∑–º–µ–Ω–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
   logger.setLevel(logging.DEBUG)
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –æ–∫–Ω–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–π:**
   ```json
   {
     "publishing": {
       "posts_per_day": 3,
       "publish_window": [8, 20],
       "interval_min": 1800,
       "interval_max": 10800
     }
   }
   ```

3. **–°–±—Ä–æ—Å—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –∑–∞ –¥–µ–Ω—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
   ```bash
   python autoposter.py reset_today
   ```

### 3. –û—à–∏–±–∫–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ WordPress/Telegram

**–ü—Ä–∏–∑–Ω–∞–∫–∏:**
- Circuit breaker –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
- –ú–Ω–æ–≥–æ—á–∏—Å–ª–µ–Ω–Ω—ã–µ retry –ø–æ–ø—ã—Ç–∫–∏
- –û—à–∏–±–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏–ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å circuit breaker
./monitor_autoposter.sh health

# –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö
grep "ERROR" logs/autoposter.log | tail -10
```

**–†–µ—à–µ–Ω–∏—è:**
1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:**
   ```bash
   # –¢–µ—Å—Ç WordPress API
   curl -X GET "https://your-site.com/wp-json/wp/v2/posts" \
        -u "username:app-password"
   
   # –¢–µ—Å—Ç Telegram API
   curl "https://api.telegram.org/bot<TOKEN>/getMe"
   ```

2. **–£–≤–µ–ª–∏—á—å—Ç–µ —Ç–∞–π–º–∞—É—Ç—ã:**
   ```json
   {
     "wordpress": {
       "timeout": 60
     },
     "telegram": {
       "timeout": 60,
       "image_timeout": 120
     }
   }
   ```

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ retry –ª–æ–≥–∏–∫—É:**
   ```json
   {
     "publishing": {
       "max_retries": 5,
       "retry_delay": 600
     }
   }
   ```

### 4. –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏

**–ü—Ä–∏–∑–Ω–∞–∫–∏:**
- –û—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ü—É—Å—Ç—ã–µ –ø–æ—Å—Ç—ã –±–µ–∑ –∫–∞—Ä—Ç–∏–Ω–æ–∫
- –¢–∞–π–º–∞—É—Ç—ã –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å Telegram

**–†–µ—à–µ–Ω–∏—è:**
1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**
   ```bash
   ls -la img/
   chmod -R 755 img/
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:**
   ```bash
   find img/ -name "*.jpg" -o -name "*.png" | xargs du -h | sort -hr
   ```

3. **–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:**
   ```bash
   # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ImageMagick –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
   find img/ -name "*.jpg" -exec convert {} -resize 1200x1200> {} \;
   ```

## üîç –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –ù–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
```bash
# –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x monitor_autoposter.sh

# –†–∞–∑–ª–∏—á–Ω—ã–µ –≤–∏–¥—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
./monitor_autoposter.sh status    # –ö—Ä–∞—Ç–∫–∏–π —Å—Ç–∞—Ç—É—Å
./monitor_autoposter.sh health    # –ê–Ω–∞–ª–∏–∑ health check
./monitor_autoposter.sh logs      # –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤
./monitor_autoposter.sh shutdown  # –ê–Ω–∞–ª–∏–∑ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
./monitor_autoposter.sh system    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
./monitor_autoposter.sh report    # –ü–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç
./monitor_autoposter.sh full      # –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
```

### –ê–Ω–∞–ª–∏–∑ health check —Ñ–∞–π–ª–∞
```bash
# –ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω jq
jq . autoposter.health

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤
jq '.publishing.slots[] | select(.status == "missed")' autoposter.health

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ circuit breaker
jq '.circuit_breaker' autoposter.health
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```bash
# –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ª–æ–≥–∞–º–∏
tail -f logs/autoposter.log

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ health check
watch -n 30 './monitor_autoposter.sh status'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
watch -n 10 'ps aux | grep autoposter'
```

## üìä –ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ä—ã

### 1. –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
```bash
# –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤
find logs/ -name "*.log.*" -mtime +7 -delete

# –ï–∂–µ–º–µ—Å—è—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
python check_db.py

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–æ–≤
./monitor_autoposter.sh report
```

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```bash
# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ cron –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫
echo "*/30 * * * * cd /path/to/autoposter && ./monitor_autoposter.sh status >> logs/monitor.log 2>&1" | crontab -
```

### 3. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ï–∂–µ–¥–Ω–µ–≤–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –±–∞–∑—ã
cp config.json config.json.backup.$(date +%Y%m%d)
cp autoposter.db autoposter.db.backup.$(date +%Y%m%d)
```

## üÜò –≠–∫—Å—Ç—Ä–µ–Ω–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ

### –ü—Ä–∏ –ø–æ–ª–Ω–æ–º —Å–±–æ–µ
1. **–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã:**
   ```bash
   ./keepalive.sh stop
   pkill -f autoposter
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–æ–≤:**
   ```bash
   python check_db.py
   python -c "import json; json.load(open('config.json'))"
   ```

3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å —á–∏—Å—Ç–æ–≥–æ –ª–∏—Å—Ç–∞:**
   ```bash
   python autoposter.py reset_today
   ./keepalive.sh start
   ```

### –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
cp autoposter.db autoposter.db.backup

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É
rm autoposter.db
python autoposter.py status  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—É—é –±–∞–∑—É
```

## üìû –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–º–æ—â–∏

–ü—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∑–∞ –ø–æ–º–æ—â—å—é –ø—Ä–∏–ª–æ–∂–∏—Ç–µ:
1. –í—ã–≤–æ–¥ `./monitor_autoposter.sh full`
2. –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤: `tail -50 logs/autoposter.log`
3. –°–æ–¥–µ—Ä–∂–∏–º–æ–µ `last_shutdown.info`
4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–±–µ–∑ –ø–∞—Ä–æ–ª–µ–π): `jq 'del(.wordpress.password, .telegram.token, .gpt.api_key)' config.json` 